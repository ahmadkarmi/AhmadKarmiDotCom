---
interface Props {
  title?: string;
  description?: string;
  variant?: 'card' | 'minimal';
}

const { 
  title = "Enjoyed this article?", 
  description = "Get more insights on AI, product strategy, and digital growth delivered to your inbox.",
  variant = 'card'
} = Astro.props;
---

<div class:list={[
  "bg-foreground text-background rounded-2xl",
  variant === 'card' ? "p-8 md:p-10 mt-16" : "p-0 bg-transparent text-foreground mt-0"
]}>
  <div class:list={[
    "text-center",
    variant === 'minimal' ? "max-w-2xl mx-auto" : ""
  ]}>
    {variant === 'card' && (
      <p class="text-accent font-medium mb-3 uppercase tracking-wider text-xs">Stay Updated</p>
    )}
    
    <h3 class:list={[
      "font-display mb-3",
      variant === 'card' ? "text-2xl md:text-3xl text-background" : "text-3xl md:text-4xl text-foreground"
    ]}>
      {title}
    </h3>
    
    <p class:list={[
      "text-base mb-8 max-w-lg mx-auto",
      variant === 'card' ? "text-gray-400" : "text-foreground-secondary"
    ]}>
      {description}
    </p>
    
    <!-- Kit.com Newsletter Form -->
    <form 
      id="newsletter-form"
      action="https://app.kit.com/forms/6804021/subscriptions" 
      method="post"
      data-sv-form="6804021"
      data-uid="ad5d099d77"
      data-format="inline"
      data-version="5"
      class="max-w-md mx-auto"
    >
      <div class="flex flex-col sm:flex-row gap-3">
        <input 
          type="email" 
          name="email_address" 
          placeholder="Enter your email"
          aria-label="Email address"
          required
          class:list={[
            "flex-1 px-4 py-3 border rounded-lg focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent transition-all text-sm",
            variant === 'card' 
              ? "bg-background/10 border-background/20 text-background placeholder:text-gray-500" 
              : "bg-background-secondary border-border text-foreground placeholder:text-foreground-muted"
          ]}
        />
        
        <!-- Honeypot -->
        <div class="opacity-0 absolute -z-10 w-0 h-0 overflow-hidden">
          <label for="website_url">Website</label>
          <input type="text" name="website_url" id="website_url" tabindex="-1" autocomplete="off" />
        </div>

        <button 
          type="submit" 
          class="px-6 py-3 bg-accent text-white font-semibold rounded-lg hover:bg-accent/90 transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-foreground text-sm whitespace-nowrap"
        >
          Subscribe
        </button>
      </div>
    </form>
    
    <script>
      function initNewsletterForm() {
        const form = document.getElementById('newsletter-form');
        if (!form) return;
        if (form.dataset.newsletterFormBound === '1') return;
        form.dataset.newsletterFormBound = '1';

        form.addEventListener('submit', (e) => {
          const honeyInput = form.querySelector('input[name="website_url"]');
          if (honeyInput && honeyInput.value) {
            e.preventDefault();
            console.log('Bot detected');
            return false;
          }
        });
      }

      if (!window.__newsletterFormInitBound) {
        window.__newsletterFormInitBound = true;
        document.addEventListener('astro:page-load', initNewsletterForm);
      }
      initNewsletterForm();
    </script>
    
    <p class:list={[
      "text-xs mt-4",
      variant === 'card' ? "text-gray-500" : "text-foreground-muted"
    ]}>
      No spam. Unsubscribe anytime.
    </p>
  </div>
</div>

<!-- Kit.com Script (only load once per page) -->
<script is:inline>
  if (!window.kitScriptLoaded) {
    const script = document.createElement('script');
    script.src = "https://f.convertkit.com/ckjs/ck.5.js";
    script.defer = true;
    document.body.appendChild(script);
    window.kitScriptLoaded = true;
  }
</script>
